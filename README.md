# Plugin AINSYS Connector Replace Content

The plugin is designed to replace the content lines on the site. It works on the basis of the ANSYS Connector plugin

<img width="1920" alt="Untitled (Copy)" src="https://user-images.githubusercontent.com/109792620/194012411-3f4f21a7-ecc1-4c7c-97a1-203ba29a2691.png">

____

#### :white_check_mark: Данный способ замены контента предполагает собой **Наличие  [Google Sheets (Таблицы Гугл)](https://docs.google.com/spreadsheets)**, в которых указывются необходимые строки и контент который должен подменяться
____

### :exclamation: :exclamation: **Обязательные требования к данным в таблице  [Google Sheets](https://docs.google.com/spreadsheets)**

   1) Данные для подмены указываются в формате **`{string}`**. Как на сайте, так и в таблице Гугл. В **Коннекторе** системы [AINSYS](https://app.ainsys.com/), формируется `JSON` файл с аналогичной структурой например: `"{string}": "some-example"`

   2) :exclamation: :exclamation: :exclamation: В таблицах Гугл, **обязательно** должен быть указан **`ID`** страницы с сайта, которая предназначена для подмены (редактирования) **контента**. Для этого в таблице Гугл **обязательно** должно быть создано соответствующее поле с именем: **`pageId`**

   3) :exclamation: :exclamation: :exclamation: Обзязательно должен быть язык сайта в формате **`/RU-ru`**, в соответствующем поле **`pageLang`** в  [Google Sheets](https://docs.google.com/spreadsheets)

____

    Алгоритм передачи данных Plugin AINSYS Connector Replace Content

  1) Данные из Гугл таблиц передаются в систему [AINSYS](https://app.ainsys.com/)
  
  2) Через специальный коннектор в системе [AINSYS](https://app.ainsys.com/), данные передаются на сайт с помощью **`WEBHOOK`**
  
  3) В первое соединение **`сайта с системой` [AINSYS](https://app.ainsys.com/),** происходит передача **`ВСЕХ (all data)`** существующих в таблице данных. В последующем, происходит передача только `измененных данных`
  
  4) Данные на **`WEBHOOK`** принимаются специальным плагином **`Main Ainsys Connector`**
  
  5) Через фильтр `ainsys_webhook_action_handlers`, данные обрабатываются `этим` плагином
  
  6) Обработка данных в плагине **`Plugin AINSYS Connector Replace Content`**  происходит следующи образом:
  
       ##### :white_check_mark: 6.1 Принимаются данные на фильтре `ainsys_webhook_action_handlers`
       ##### :white_check_mark: 6.2 После проверок на существование `ID` страницы, и соответствия текущей и переданой локали `(/RU-ru)`, происходит запись полученных данных в метаданные страницы, для которой эти данные предназначены
       ##### :white_check_mark: 6.3 Далее с помощью фильтра `the_content` происходит подмена полученных данных
       
____

> :exclamation: Для справки: "Фильтр **the_content** срабатывает после получения данных из **БД**, **и до вывода данных на странице**. Таким образом, происходит не замена данных в **БД**, а их подмена в момент рендеринга страницы (в момент отдачи страницы сервером на сайт). Следует отметить, что до реализации автоматического получения данных из системы [AINSYS](https://app.ainsys.com/), использовалась ручная загрузка из приложенного файла JSON. В связи с этим, в плагине реализована обратная совместимость с данным способом, чтобы не ломать отображение сайта.
____
